specs := $(shell find ./tests -name '*.test.js' ! -path "*node_modules/*")
reporter = spec
opts =
test:
	@rm -fr tests/_site
	@node_modules/.bin/mocha --reporter ${reporter} ${opts} ${specs}

out = _site/coverage.html
coverage:
	@rm -fr lib-cov
	@jscoverage lib lib-cov
	@JS_COVERAGE=1 $(MAKE) test reporter=html-cov > ${out}
	@echo
	@rm -fr lib-cov
	@echo "Built Report to ${out}"
	@echo

theme = $(HOME)/.spm/themes/one
documentation:
	@cp README.md _docs/index.md
	@nico build -C nico.json -q --theme=${theme}

server: documentation
	@nico server -C nico.json -v --theme=${theme}

publish: clean documentation coverage
	@ghp-import _site
	@git push origin gh-pages

clean:
	@rm -fr tests/_site
	@rm -fr _site

.PHONY: all build test lint coverage
